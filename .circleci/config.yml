version: 2
orbs:
  aws-ecr: circleci/aws-ecr@6.7.0
jobs:
  build:
    docker: 
      - image: circleci/node:4.8.2 
    steps:
      - run: echo "hello world" 
  aws-ecr/build_and_push_image:
    account-url: "${AWS_ACCOUNT_ID}.dkr.ecr.${AWS_DEFAULT_REGION}.amazonaws.com"
    aws-access-key-id: ${AWS_ACCESS_KEY_ID}
    aws-secret-access-key: ${AWS_SECRET_ACCESS_KEY}
    repo: coach-tools-backend
    create-repo: true
    region: ${AWS_DEFAULT_REGION}
    tag: ${CIRCLE_SHA1}
workflows:
  version: 2
  build-deploy:
    jobs:
      - build
      - aws-ecr/build_and_push_image:
          requires:
            - build
     

# version: 2.1
# orbs:
#   aws-ecr: circleci/aws-ecr@0.0.2
#   aws-ecs: circleci/aws-ecs@0.0.8
# workflows:
#   build-and-deploy:
#     jobs:
#       - aws-ecr/build_and_push_image:
#           account-url: "${AWS_ACCOUNT_ID}.dkr.ecr.${AWS_DEFAULT_REGION}.amazonaws.com"
#           repo: circleci
#           region: ${AWS_DEFAULT_REGION}
#           tag: ${CIRCLE_SHA1}
#       - aws-ecs/deploy-service-update:
#           requires:
#             - aws-ecr/build_and_push_image
#           aws-region: ${AWS_DEFAULT_REGION}
#           family: "simple-service"
#           service-name: "simple-service-Service-1KBUPSYYJ3I8D"
#           cluster-name: "simple-cluster-Cluster-O1RT4ZD9110D"
#           container-image-name-updates: "container=app,tag=${CIRCLE_SHA1}"